Updated: 2/24/2001

Here is a log of a DOS install on a 3350.

For a 3330, at least the following would need changing:

     intdsk.jcl: D8 changes to D4 for a 3330-1
     intdsk.jcl: VTOC location  (I don't have a recommended location handy)
     ipl.jcl:    Use LABELS 30
     power.jcl:  Move and shrink the various files, watch out for conflicts.

This was done under Hercules 2.12 and Windows 98.

A lot of the new material is based on posts from Ivanilton. 

Current known problems:

     LVTOC loops on the 2nd track while printing a VTOC.

Update Log:

	2/24/01 Updated:

		DOSRES -> SYSRES
		VTOC -> Cylinder 554
                Added instructions for getting IPL commands from card reader.
                Added instructions for starting POWER (thanks to Ivanilton)
                Added instructions for shutting down (thanks to Ivanilton)
                Added ipl.jcl (Thanks to Ivanilton)
                Added power.jcl (Thanks to Ivanilton)
                Added dserv.jcl (Thanks to Ivanilton)

	2/16/01	Initial Document
  
                INTDSK and RESTORE
                (Thanks to Richard Brandle and G. Alan Sansom)

Credits:

     Richard Brandle and G. Alan Sansom -- working to puzzle out the
     initial restore.

     Ivanilton: Information on ipl commands, power and other useful
     JCL.  (Not all of it is in here -- check out the mailing list).

PROMPTS:

I used $ to indicate your DOS or Shell Prompt

I used  Command ==> for Hercules commands.

For data to enter on the 3270, I preface it with "**> Enter:"  
"ENTER" is the 3270 enter key.  ("CLEAR" is the 3270 clear key).
I used elipses (.....) to indicate lines of 3270 console output
that I removed.

Jay Jaeger, 2/16/01

*********************************

1.  Get and install hercules.

2.  Make a directory to hold your DOS/VS stuff.  Mine looks like:

    /DOS
        ./DEV	(For disk and tape images)

3.  Get the dos aws tape image file dosrel34.aws, and put it in a file.

    I used: DOS/DEV/dosrel34.aws

4.  Create a configuration file for Hercules.  (See Below)
    (Mine is called dosrel34.cnf )

5.  Create a disk drive image file in DOS/DEV/sysres.3350

    $ dasdinit sysres.3350 3350 sysres 560

    Important note:  This *must* include the space for the alternate cylinders.
    Since a 3350 is 555 Cylinders plus 5 alternates, we get 560.

6.  Prepare an INTDSK / RESTORE JCL deck (See Below)

    Device notes:  

	The device type is specified as the third parameter to // ASSGN
	Examples: C2 for 3270 console, D8 for 3350 disk, T2 for 3420.

7.  Start up hercules.

    $ hercules -f dos3350.cnf >herc.log

8.  Telnet in with a 3270 emulator to the port identified in the 
    hercules configuration file.  Mine was set to 3270.

9.  IPL the tape (In my case, IPL 180)

10. Once the IPL has completed (wait state), enter:

    Command ==> devinit c intdsk.jcl trunc eof
    (ascii is implied).

    The CPU should start, and pretty soon you should see:

    S310I  CONTROL CARD ANALYSIS AND LABEL CHECKING
    S311I  UTILITY MODIFIER CARD
    // UID IQ

    S341I  NO SURFACE ANALYSIS, ONLY R0 GENERATION
    S342I  SYSOPT IN PROCESS

11. Wait.  You will see lots of disk I/O on the Hercules machine
    console.  The processing will continue until you see the
    following (they will fly by fast)

    S370I  *VOL/VTOC LABELS CONTORL SET.*
    S342I  SYSOPT IN PROCESS
    // VTOC STRTADR=(0554000),EXTENT=(30)
    VOL1SYSRES
    S371I  INITIALIZE DISK FUNCTIONS COMPLETED
    *
    ***** DO NOT RE-IPL, BUT HAVE CARD READER READIED WITH
    ***** JOB CONTROL CARDS TO START THE RESTORE FUNCTION
    *
    
12. At this point, the screen will clear because of the
    // ALLOC SYSLOG statement, and you will see
                                                                   
    SR01D  *** GIVE SYSTEM LIBRARY ALLOCATIONS ***
    CL=

13. For each of these reqquests below, hit ENTER to accept the default.
    It will report back the allocation, which generally will match
    the Program Directory.  Then you will see:


    SR03I  ALLOC DEFAULTS TO 21(8)
    RL=
    SR03I  ALLOC DEFAULTS TO 19(4)
    SL=
    SR03I  ALLOC DEFAULTS TO 36(2)
    PL=
    SR03I  ALLOC DEFAULTS TO 1(2)
    SR32D  TYPE DESIRED LABEL FOR LIBRARY                                         
    LABEL=
    SR10I  FILE ID=DOS.SYSRES.FILE                                                
    
14. For each of these, it will report back the allocation which
    will generally match the Program Directory.
    Then you will see:

    SR09D  TYPE GO IF ALLOCATION IS CORRECT

    **> Enter:  GO  (and hit ENTER)

15. The system will now busily restore the disk data pack.

    SR10I  FILE ID=DOS.SYSRES.FILE
    SR11I  EXTENT=CYL 000 TRK 01 - CYL 077 TRK 29
    SR12I  RESTORE OF  SYSTEM CORE IMAGE LIBRARY IN PROGRESS
    SR17I  RESTORE HAS BEEN SUCCESSFUL
    SR12I  RESTORE OF  SYSTEM RELOCATABLE LIBRARY IN PROGRESS
    SR17I  RESTORE HAS BEEN SUCCESSFUL
    SR12I  RESTORE OF  SYSTEM SOURCE STATEMENT LIBRARY IN PROGRESS
    SR17I  RESTORE HAS BEEN SUCCESSFUL
    SR12I  RESTORE OF  SYSTEM PROCEDURE LIBRARY IN PROGRESS
    SR17I  RESTORE HAS BEEN SUCCESSFUL
    SR14I  *** RESTORE COMPLETE ***
    SR39I  END OF JOB

16. The system will enter a disabled wait.
    Go to the hercules console and do:

    Command ==> stop

    (This might be a good time to gzip/zip up the sysres.3350 disk image.)

    <<<<<<<<<< RETURN TO THIS POINT TO RE-IPL >>>>>>>>>>

17. Restart Hercules (if you stopped for a backup), go to the
    Hercules console, and do:

    Command ==> ipl 24F    (or wherever your sysres address is)

    **> Hit "CLEAR" on your 3270 screen, and you should see:

    0I04I IPLDEV=X'24F',VOLSER=SYSRES,CPUID=000006110148
    0I03A SPECIFY SUPERVISOR NAME

    **> Enter:  $$A$SUP3   (and hit ENTER). 

    or other supervisor name of your choice.

18. Now, you *could* hit "CLEAR" at this point, and enter IPL
    commands manually.  But, thanks to Ivanilton, we have a set
    of ready-made IPL commands.

    On the Hercules consoe do:

    Command ==> devinit c ipl.jcl trunc eof

    The IPL commands will run.  They will more than fill up the
    screen, which should automatically clear, leaving you with
    something like:

    01 ADD X'01F',3277
    02 
    03 ADD X'180',3420T9
    04 
    05 ADD X'24F',3350
    06 
    07 SET
    08 
    09 DPD UNIT=X'24F',VOLID=SYSRES,CYL=400                     
    10 
    11 0I52I PAGE DATA SET EXTENT      LOW    HIGH
    12                              400   0 403  29
    13 0I20I IPL COMPLETE FOR DOS/VS REL 34.0 ECLEVEL=0K
    14*BG 1I00A  READY FOR COMMUNICATIONS.

    0D07D  ENTER RESPONSE
    BG   

19. THE FIRST TIME YOU IPL, you need to clear the recorder
    file and the hardcopy file.  Enter the following on the
    3270 console:

    **> Enter: set rf=create,hc=create   (and hit ENTER)

    REMEMBER YOU ONLY WANT TO DO THIS AT THE FIRST IPL.

    After a bit, this will be followed by:

    0D07D  ENTER RESPONSE
    BG

20. You now want to assign the card reader at x'00c' to
    BG, so enter the following on the 3270 console:

    **> Enter: assgn sysin,x'00c'  (and hit ENTER)

    This will be followed by:

    0D07D  ENTER RESPONSE
    BG

21. Now we are ready to run the LABELS50 proc and the
    dummy job at the end of IPL.JCL.    

    **> Just hit ENTER.  You should see:

    01 BG assgn sysin,x'00c'
    02 BG 
    03 BG *  STANDARD LABELS FOR 3350
    04 BG *  EXTENT SYSVIS,SYSRES,1,0,2520,270     9 CYLS,  84 -  92, ON SYSRES
    05 BG *  EXTENT VTOC                           1 CYL , 554 - 554, ON SYSRES
    06 BG *  DOS/VS 3350 STANDARD LABELS CREATED  *
    07 BG EOP LABELS50
    08 BG 1T20I  SYSREC HAS BEEN ASSIGNED TO X'24F'
    09 BG // JOB DUMMY
    10    DATE 02/24/73,CLOCK 15/30/47
    ......
    20 
    0D07D  ENTER RESPONSE 
    BG  1I89A  IPL REASON CODE = 

    **> Just hit ENTER.

    You should then see:

    0D07D  ENTER RESPONSE 
    BG  1I91A  SUB-SYSTEM ID = 

    **> Again, just hit ENTER.

    You should then see:

    .....
    11 BG 1I89A  IPL REASON CODE = 
    12 BG 1I91A  SUB-SYSTEM ID =
    13 BG 1I93I  RECORDER FILE IS   1% FULL 
    14 BG EOJ DUMMY
    15    DATE 02/24/73,CLOCK 15/33/00,DURATION 00/02/13
    16*BG 1C00A  ATTN. 00C
    .....
    20                                                  
    0D07D  ENTER RESPONSE
    BG 

22. DOS/VS is now IPL'd.  Next thing, you will probably want
    to bring up POWER.  

    The "ATTN. 00C" is telling us that the card reader is hungry, 
    but it isn't dinner time for BG *yet*.  We want POWER to run in F1,
    so we need to unassign the card reader from BG.

    (Note:  Sometimes you 3270 keyboard might be locked at this
    point.  Just hit 3270 Reset if it is).

    Enter: **> assgn sysin,ua  (and hit ENTER)

    You should then see:

    17 BG assgn sysin,ua 
    .....
    20 
    0D07D  ENTER RESPONSE
    BG 

    This deassigns sysin from the card reader, making it available to
    F1 later

23. Next, we need to stop BG, because we don't want POWER to
    run there, and start F1, because we DO want POWER to run in
    that partition.  (At least that is what I think the purpose
    of these commands is.  I'm not a DOS expert....  8-)  ).
    On the 3270 console

    **> Enter:  STOP   (and hit ENTER)

    Then, 

    **> Enter: START F1   (and hit ENTER)

    You will seem something like:

    17 BG stop 
    18 AR START F1 
    .....
    20 
                                                                       
    START F1
                                                                       
             0D09D  READ IS WAITING - CANCEL OR CONTINUE

24. **> Press CLEAR, and then hit ENTER.  

    I then get:

    18 AR START F1 
    .....
    20                    
    0D07D  ENTER RESPONSE 
    F1                    

25. We need to tell F1 where to read the POWER JCL, so on the
    3270 console:

    **> Enter: assgn sysin,x'00c'    (and hit ENTER)

    You should see:

    14 F1 assgn sysin,x'00c'
    .....
    20                      
    0D07D  ENTER RESPONSE   
    F1                      

26. Finally, we are ready to read in the POWER JCL.  On the
    Hercules console, enter:

    Command ==> devinit c power.jcl trunc eof

    Then, on the 3270 console

    **> Just hit ENTER.

    You should see something like:

    14 F1 // JOB POWER
    15    DATE 02/24/73,CLOCK 15/57/26
    16 F1 1T20I  SYS000 HAS BEEN ASSIGNED TO X'24F'
    17 F1 1T20I  SYS001 HAS BEEN ASSIGNED TO X'24F'
    18 F1 1T20I  SYS002 HAS BEEN ASSIGNED TO X'24F'
    19 
    20 
    0D07D  ENTER RESPONSE
    F1  1Q11D  FORMAT QUEUES=

27A.FOR THE FIRST IPL, WE WANT TO REFORMAT THE QUEUES.

    FOR THE FIRST IPL ONLY, ENTER:

    **> Enter: q,d,a   (and hit ENTER)

    You will then see:

    19 F1 1Q11D  FORMAT QUEUES=q,d,a
    20                              

    WAIT for the formatting to finish.  (You will see lots
    of disk I/O under Hercules while this is going on).

27B. IF THIS IS NOT THE FIRST IPL:

    **> Just hit ENTER.

28. WAIT until you see:

    06 F1 1R75I  BG AUTOSTARTED
    07 F1 1R75I  F2 AUTOSTARTED

    And then, if necessary press ENTER.  

    You MAY then see something like:

    09 F1 1Q34I  PUN WAITING FOR WORK ON 00D 
    10*BG 1C10A  PLEASE ASSIGN SYSRDR.
    11 F1 0P08I C  INTERV REQ SYS021=00C
    12 F1 1Q34I  LST WAITING FOR WORK ON 00E 
    .....
    20 
    0D07D  ENTER RESPONSE
    BG

29. We now need to assign sysin, syslst and syspch in each
    partition.  I *think* that these are, in a sense, "virtual",
    and what really feeds them is POWER.

    As we enter each one (starting at a BG prompt), you will
    see the prompt switch back and forth between BG and F2.  
    Make sure you get all 3 assignments into each partition.
    Hitting "ENTER" at the prompt for a given partition seems to
    end the process for that partition.

    (If you see F1 1Q61I  IRRECOVERABLE I/O ERROR ON 00C, followed
    by F1 1Q71I  RDR ,00C TERMINATED  while you are doing this, 
    don't fret -- we'll deal with that later.  You might also see
    F1 1Q12I  POWER/VS INITIATION COMPLETED while you are doing this.

    Hit ENTER after entering each of these:

    BG  **> Enter: assgn sysin,x'00c'
    F2  **> Enter: assgn sysin,x'00c'
    BG  **> Enter: assgn syslst,x'00e'
    F2  **> Enter: assgn syslst,x'00e'
    BG  **> Enter: assgn syspch,x'00d'
    F2  **> Enter: assgn syspch,x'00d'

    Now we are done with the assignments, so tell the system we
    are done:

    BG  **> ENTER
    F2  **> ENTER

    By the time I did this, my screen had cleared once, but here
    is what I saw at the tail end:

    01 BG assgn syslst,x'00e'
    02 F1 1Q71I  RDR ,00C TERMINATED
    03 F2 assgn syslst,x'00e'
    04 BG assgn syspch,x'00d'
    05 F1 1Q12I  POWER/VS INITIATION COMPLETED
    06 F2 assgn syspch,x'00d'
    07 BG 
    08 F2 
    09 F1 1Q34I   BG WAITING FOR WORK
    10 F1 1Q34I   F2 WAITING FOR WORK
    
30. CONGRATULATIONS.  POWER is now running.  
    Let's try various commands:

    **> Enter: d rdr,free    (and hit ENTER)

    11 AR D RDR,FREE                            
    12 F1 1R46I  READER QUEUE NOTHING TO DISPLAY

    **> Enter: map   (and hit ENTER)

    07 AR map 
    08 AR AREA   K-REAL UPPER LIM K-VIRT UPPER LIM  NAME 
    09 AR 
    10 AR SP        74K     127FF            40000
    11 AR BG  V3A   32K     1A7FF   600K     D5FFF  NO NAME
    12 AR F2  V2A   30K     21FFF   600K    16BFFF  NO NAME
    13 AR F1  V1A   22K     277FF   172K    196FFF  POWER  
    14 AR SVA                       400K    1FAFFF 
    15 AR VIS                        60K    1FAFFF
    16 AR PP        98K     3FFFF

    **> Enter: d t    (and hit ENTER)

    17 AR d t
    18 F1 1R46I  TIME IS 16:18:16, DATE IS 02/24/73
    19 F1 1R46I  005 PAGES FIXED, 006 CURRENT TASKS

31. OK!  Time to run our very first job under POWER.  It might
    be good to list our Core Image, Relocatable, Macro, Source and
    Procedure libraries.  Ivanilton provided us with a job that does
    just that.

    First, lets switch our Hercules printer to a new file:

    Command ==> devinit e dev/dserv.lst

    Then, lets feed in some cards:
 
    Command ==> devinit c dserv.jcl trunc eof

32. Now, remember when we got these messages, a while back?

    F1 1Q61I  IRRECOVERABLE I/O ERROR ON 00C
    F1 1Q71I  RDR ,00C TERMINATED

    That is why nothing seemed to happen when we did the "devinit c".
    We need to "wake up" the POWER reader.

    **> Enter: PSTART RDR,00C   (and hit ENTER)

    You should then see something like:

    01 AR PSTART RDR,00C
    02 F1 1Q34I  RDR WAITING FOR WORK ON 00C
    03 F1 1Q47I   BG DSERV 00002 FROM 000 TEST
    04 BG // JOB DSERV TEST
    05    DATE 02/24/73,CLOCK 16/23/06
    06 BG EOJ CSERV
    07    DATE 02/24/73,CLOCK 16/23/17,DURATION 00/00/10
    08*F1 1Q40A  ON 00E FORMS 0001 NEEDED FOR DSERV    00002 
    09 F1 1Q34I   BG WAITING FOR WORK
    
33. Now the printer wants our attention.  What a crybaby. 8-)

    **> Enter: g 00e     (and hit ENTER)

    This tells POWER we put forms known as "0001" in the printer.
    (Operators never lie, right??  8-)  )

    After a little bit of activity, you should see:

    11 F1 1Q34I  LST WAITING FOR WORK ON 00E

    Your output is now availalbe on the printer (in the Hercules
    printer file).

    We can ask if there is anything on the POWER printer queue:
 
    **> Enter: d lst,free     (and hit ENTER)

    05 AR D LST,FREE
    06 F1 1R46I    LIST QUEUE NOTHING TO DISPLAY
    

34. At this point, you can run jobs just by sticking them in the
    card reader and doing:

    devinit c yourjob.jcl trunc eof

    If you blow it, and feed it a bad file, or have a JCL error, 
    and the POWER Reader dies, just do the "PSTART RDR,00C" again.

35. Finally, after all of that excitement, its time to shut down.

    First, we need to tell POWER to go to bed:

    **> Enter: PEND   (and hit ENTER)

    You should see something like:

    08 F1 1R99I  POWER/VS IS IN THE SHUTDOWN PERIOD
    09 F1 1Q33I  STOPPED PUN ,00D
    10 F1 1Q33I  STOPPED LST ,00E
    11 F1 1Q33I   STOPPED BG
    12*F2 1I00A  READY FOR COMMUNICATIONS.
    13 F1 1Q33I   STOPPED F2
    .....

    pend                                                   

             0D09D  READ IS WAITING - CANCEL OR CONTINUE
    
    **> Hit CLEAR, and then hit ENTER, and you should see:

    0D07D  ENTER RESPONSE
    F2

36. We need to stop all of the partitions, but we need to
    tell BG to end the recorder as well.  At each of the
    prompts, reply as indicated:

    F2 **> Enter:  STOP  (and hit ENTER)    
    F1 **> Enter:  STOP  (and hit ENTER) (if you get F1 prompt)
    BG **> Enter:  ROD   (and hit ENTER)

    You will then see:

    BG  1I90A  END OF DAY = 

    **> Enter: Y     (and hit ENTER)

    You will then see:

    18 BG 1I90A  END OF DAY = y            
    19*F1 1I00A  READY FOR COMMUNICATIONS. 
    20 BG 1I93I  RECORDER FILE IS   1% FULL
    0D07D  ENTER RESPONSE                  
    F1                                     

    (You may see F1 1Q21I  POWER/VS HAS BEEN TERMINATED  as well)
 
    F1 **>  STOP   (and hit ENTER)

    By now, you should have also received:

    07 BG 1I82I  RECORDING COMPLETE. 

    BG **>  STOP   (and hit ENTER)


37. Now you can safely shut down Hercules:

    Command ==> stop
    Command ==> quit


Jay Jaeger

--------- SAMPLE CONFIGURATION FILE (dos3350.cnf) ----------

#
# Configuration file for Hercules ESA/390 emulator
#
#	DOS/VS R34
#

CPUSERIAL 000611
CPUMODEL  0148
MAINSIZE  6
XPNDSIZE  0
CNSLPORT  3270
NUMCPU    1
LOADPARM  ........
SYSEPOCH  1928
TZOFFSET  -0600
TODDRAG   1
ARCHMODE  S/370

000C    3505
000D    3525    dev/pch00d.txt ascii
000E    1403    dev/prt00e.txt

001F	3270
0180	3420	dev/dosrel34.aws
024F	3350	dev/sysres.3350



----------  SAMPLE INTDSK.JCL ----------

// JOB INTDSK
// DATE 02/24/73
// ASSGN SYSLOG,X'01F',C2
// ASSGN SYSLST,X'00E',L1
// ASSGN SYSIPT,X'180',T2
// ASSGN SYSOPT,X'24F',D8
// EXEC
// UID IQ
// VTOC STRTADR=(0554000),EXTENT=(30)
VOL1SYSRES
// END
// JOB RESTOR
// DATE 02/24/73
// ASSGN SYSLOG,X'01F',C2
// ASSGN SYSLST,X'00E',L1
// ASSGN SYSIPT,X'180',T2
// ASSGN SYS005,X'24F',D8
// ASSGN SYS006,X'180',T2
// EXEC
// END


---------- SAMPLE IPL.JCL ----------
( Thanks to Ivanilton )

DEL X'00C'
ADD X'00C',3505
DEL X'00D'
ADD X'00D',3525P
DEL X'00E'
ADD X'00E',1403
DEL X'01F'
ADD X'01F',3277
ADD X'180',3420T9
ADD X'24F',3350
SET
DPD UNIT=X'24F',VOLID=SYSRES,CYL=400
// EXEC PROC=LABELS50
ASSGN SYSREC,SYSRES
// JOB DUMMY
/&


---------- SAMPLE POWER.JCL ----------
( Thanks to Ivanilton )

// JOB POWER
// DLBL IJAFILE,'POWER.ACCOUNT.FILE',99/365,DA
// EXTENT SYS000,SYSRES,1,0,9000,90             3 CYLS, 300 - 302, ON SYSRES
// DLBL IJQFILE,'POWER.QUEUE.FILE',99/365,DA
// EXTENT SYS001,SYSRES,1,0,9090,120            4 CYLS, 303 - 306, ON SYSRES
// DLBL IJDFILE,'POWER.DATA.FILE',99/365,DA
// EXTENT SYS002,SYSRES,1,0,6000,3000         100 CYLS, 200 - 299, ON SYSRES
ASSGN SYS000,SYSRES
ASSGN SYS001,SYSRES
ASSGN SYS002,SYSRES
// EXEC POWER
PSTART BG,0
READER=00C
PRINTERS=00E
PUNCHES=00D
PSTART F2,2
READER=00C
PRINTERS=00E
PUNCHES=00D
PSTART PUN,00D
PSTART PRT,00E
PSTART RDR,00C


---------- DSERV.JCL ----------
(Thanks to Ivanilton)

* $$ JOB JNM=DSERV,CLASS=0,USER='TEST' 
* $$ LST LST=SYSLST,FNO=0001,CLASS=A
// JOB DSERV TEST
// EXEC DSERV
 DSPLY ALL
/*
/&
* $$ EOJ 


